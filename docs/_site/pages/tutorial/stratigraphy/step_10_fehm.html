<html lang="en-gb" dir="ltr">

<head>
    <title>LaGriT</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="LaGriT : LaGriT is a library providing mesh generation and optimization for a variety of polyhedra and dimensions.">
    <link href="https://fonts.googleapis.com/css?family=Do+Hyeon|Fira+Sans" rel="stylesheet">
    <link rel="preload" href="https://getuikit.com/fonts/ProximaNova-Reg-webfont.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="preload" href="https://getuikit.com/fonts/ProximaNova-Light-webfont.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="stylesheet" href="/assets/css/uikit_theme.css">
    <link rel="icon" type="image/x-icon" href="https://www.lanl.gov/favicon.ico">
    <link rel="stylesheet" type="text/css" href="/assets/css/footer.css">

    <!-- load stylesheets -->
    <script type="text/javascript" async="" src="https://www.google-analytics.com/analytics.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" defer=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/he/1.2.0/he.min.js" defer=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/marked/0.6.2/marked.min.js" defer=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.6.10/vue.min.js" defer=""></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue-router/3.0.2/vue-router.min.js" defer=""></script>
    <script src="https://getuikit.com/assets/uikit/dist/js/uikit.min.js?1180" defer=""></script>
    <script src="https://getuikit.com/assets/uikit/dist/js/uikit-icons.min.js?1180" defer=""></script>
    <script src="https://getuikit.com/assets/highlightjs/highlight.min.js" defer=""></script>
    <script src="https://getuikit.com/app/main.min.js?1180" defer=""></script>
    <script src="https://www.googletagmanager.com/gtag/js?id=UA-42150424-1" async=""></script>

    <!-- tipuesearch files -->
    <link rel="stylesheet" href="/assets/tipuesearch/css/normalize.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="/assets/tipuesearch/tipuesearch_content.js"></script>
    <link rel="stylesheet" href="/assets/tipuesearch/css/tipuesearch.css">
    <script src="/assets/tipuesearch/tipuesearch_set.js"></script>
    <script src="/assets/tipuesearch/tipuesearch.min.js"></script>

    <!-- Finally, load global style to overwrite template, tipuesearch, etc. -->
    <!--<link rel="stylesheet" href="/assets/globalstyle.css">-->
</head>

<body>
    <div>
        <!-- Header -->
        <div uk-sticky="media: 960" class="uk-navbar-container tm-navbar-container uk-sticky uk-sticky-fixed" style="position: fixed; top: 0px; width: 100%; color: #212328;">
            <div class="uk-container uk-container-expand">
                <nav class="uk-navbar">
                    <div class="uk-navbar-left">
                        <a href="/" class="uk-navbar-item uk-logo" style="font-family: 'Do Hyeon', sans-serif; color: white;">
                            <img uk-img src="/assets/img/logo.png" width="50" class="uk-margin-small-right" alt="LANL logo">
                            LaGriT
                        </a>
                    </div>
                    <div class="uk-navbar-right">
                        <ul class="uk-navbar-nav uk-visible@m">
                            <li><a href="/pages/commands">Commands</a></li>
                            <li><a href="/pages/release">Release Notes</a></li>
                            <li><a href="/pages/publications">Publications</a></li>
                            <li><a href="http://github.com/lanl/LaGriT"><span uk-icon="github"></span></a></li>

                            <!-- Begin search bar -->
                            <div class="nav-overlay uk-navbar-right">
                                <a class="uk-navbar-toggle" uk-search-icon uk-toggle="target: .nav-overlay; animation: uk-animation-fade" href="#"></a>
                            </div>

                            <div class="nav-overlay uk-navbar-left uk-flex-1" hidden>
                                <div class="uk-navbar-item uk-width-expand">
                                    <form class="uk-search uk-search-navbar uk-width-1-1" action="https://lanl.github.io/LaGriT/search/">
                                        <input class="uk-search-input" name="q" type="search" id="tipue_search_input" placeholder="Search..." autofocus>
                                    </form>
                                </div>
                                <a class="uk-navbar-toggle" uk-close uk-toggle="target: .nav-overlay; animation: uk-animation-fade" href="#"></a>
                            </div>

                            <script>
                                $(document).ready(function() {
                                  $('#tipue_search_input').tipuesearch({
                                        'show': 10,
                                        'newWindow'  : true,
                                        'showURL' : true,
                                        'showTitleCount' : true,
                                        'descriptiveWords' : 20,
                                        'highlightTerms' : true,
                                        'mode': 'static',
                                  });
                                });
                            </script>
                            <!-- End search bar -->

                        </ul>
                        
                        <a uk-navbar-toggle-icon="" href="#offcanvas" uk-toggle="" class="uk-navbar-toggle uk-hidden@m uk-icon uk-navbar-toggle-icon">
                            <svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="navbar-toggle-icon">
                                <rect y="9" width="20" height="2"></rect>
                                <rect y="3" width="20" height="2"></rect>
                                <rect y="15" width="20" height="2"></rect>
                            </svg>
                        </a>
                    </div>
                </nav>
            </div>
        </div>
        <div class="uk-sticky-placeholder" style="height: 80px; margin: 0px;"></div>
        <!-- End Header -->

        <!-- Main Body text -->
        <div class="tm-main uk-section uk-section-default">
            <div class="uk-container uk-container-small uk-position-relative">

                <!-- Begin breadcrumb -->
<ul class="uk-breadcrumb">
    <li><a href="/pages/tutorial/index.html">Tutorials &amp; Examples</a></li>
    <li><span>Stratigraphic Hex Mesh Tutorial</span></li>
</ul>
<!-- End breadcrumb -->

<!-- Begin image -->
<p><img data-src="/pages/tutorial/stratigraphy/images/21_tet_01_fehm_voronoi.png" width="639" height="525" alt="" uk-img="" />
<br />
<!-- End image --></p>

<h2 id="dump-fehm" class="uk-h3 uk-margin-remove">10. Write FEHM Files</h2>

<p>Write out a series of files for the FEHM flow and transport code. 
FEHM uses the control volume finite element method (CVFE) with node materials
and properties assigned to the mesh nodes.</p>

<p>The image shows the tetrahedral mesh colored by the 6 node <code class="language-plaintext highlighter-rouge">imt</code> (materials)
values and showing the voronoi cell edges.</p>

<p>These two close-up images show the relationship between the Delaunay tet mesh
edges and the voronoi volumes, the latter of which are used by FEHM.
The mesh nodes are the vertices of the tetrahedral elements and are the center
of each voronoi volume.</p>

<!-- Lightbox -->
<div class="uk-child-width-1-2@m" uk-grid="" uk-lightbox="animation: slide">
    <div>
        <a class="uk-inline" href="/pages/tutorial/stratigraphy/images/21_tet_01_fehm_tet_a.png" data-caption="Close-up view of mesh with Delaunay tetrahedral cells">
            <img src="/pages/tutorial/stratigraphy/images/21_tet_01_fehm_tet_a.png" alt="" />
        </a>
    </div>
    <div>
        <a class="uk-inline" href="/pages/tutorial/stratigraphy/images/21_tet_01_fehm_vor_a.png" data-caption="Close-up view of mesh with Voronoi cells">
            <img src="/pages/tutorial/stratigraphy/images/21_tet_01_fehm_vor_a.png" alt="" />
        </a>
    </div>
</div>

<p>We prepare the tet mesh for FEHM with the following commands. These ensure
that there are no duplicate nodes and sets the elements to a single material.
We also make sure nodes are not doubly defined and parent-child chains are
removed.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cmo/select/motet                                                               
resetpts/parent                                                                 
filter/1,0,0     
rmpoint/compress
</code></pre></div></div>

<p>LaGriT can write a full set of FEHM model files with a single command.
The <code class="language-plaintext highlighter-rouge">keepatt</code> option will save attributes tagging nodes on the outside boundaries.
These can be used to define additional point sets and zones for FEHM.</p>

<p>The following files are written:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">.fehm</code> - mesh coordinates and geometry</li>
  <li><code class="language-plaintext highlighter-rouge">_material.zone</code> - node imt (material) zone lists</li>
  <li><code class="language-plaintext highlighter-rouge">_outside.zone</code> - node external boundary zone lists</li>
  <li><code class="language-plaintext highlighter-rouge">_outside_vor.area</code> - node external boundary area lists</li>
  <li><code class="language-plaintext highlighter-rouge">_interface.zone</code> - zone lists for nodes along material interfaces</li>
  <li><code class="language-plaintext highlighter-rouge">_multi_mat.zone</code> - lists of node pairs connected across material interfaces</li>
  <li><code class="language-plaintext highlighter-rouge">.stor</code> - FEHM format file giving the voronoi (control volume) associated with each node and the sparce matrix structure</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dump / fehm / mesh / motet / keepatt
</code></pre></div></div>

<p>Review the report written to the screen and the output file (<code class="language-plaintext highlighter-rouge">lagrit.out</code>) for
mesh quantities.
These are usful summaries and will help in finding problems in the mesh design.
Check that material node counts are as expected.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>*** Write FEHMN GEOM AND ZONE FILES ***                                         
*********dump_material_lists********                                            
Minimum material ID value =      1                                              
Maximum material ID value =      6                                              
Total possible materials  =      6                                              
Material           1 has     23944 nodes. #nodes/nnodes is   0.207223027945     
Material           2 has      6867 nodes. #nodes/nnodes is   0.594303607941E-01 
Material           3 has     16072 nodes. #nodes/nnodes is   0.139094918966     
Material           4 has     33192 nodes. #nodes/nnodes is   0.287259727716     
Material           5 has     12871 nodes. #nodes/nnodes is   0.111391901970     
Material           6 has     22601 nodes. #nodes/nnodes is   0.195600062609   
</code></pre></div></div>

<p>Check that the Sparse Matrix volumes are positive.
Negative coefficient values can result from poorly formed tetrahedra.
These usually occur on non-convex boundaries.
FEHM will still run but accuracy may be impacted.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>*** Construct and Compress Sparse Matrix:3D ***                                 
   *** Compress Area Coefficient Values ***                                     
 
AMatbld3d_stor: Matrix compress_eps:  0.1000000E-07                             
AMatbld3d_stor: Local epsilon:  0.1000000E-14                                   
AMatbld3d_stor: *****Zero Negative Coefficients ******                          
AMatbld3d_stor: Number of 'zero' (&lt; compress_eps) coefs         0               
AMatbld3d_stor: npoints =   115547  ncoefs =     964637                         
AMatbld3d_stor: Number of unique coefs =       313                              
AMatbld3d_stor: Maximum num. connections to a node =         25                 
AMatbld3d_stor: Volume min =   7.4999999E+02                                    
AMatbld3d_stor: Volume max =   7.6800000E+05                                    
AMatbld3d_stor: Total Volume:   2.3846400E+10                                   
AMatbld3d_stor: abs(Aij/xij) min =   0.0000000E+00                              
AMatbld3d_stor: abs(Aij/xij) max =   1.3500000E+02                              
AMatbld3d_stor: (Aij/xij) max =   0.0000000E+00                                 
AMatbld3d_stor: (Aij/xij) min =  -1.3500000E+02                                 
AMatbld3d_stor Matrix coefficient values stored as scalar area/distance         
AMatbld3d_stor Matrix compression used for graph and coefficient values         
ascii STOR file written with name mesh.stor   
</code></pre></div></div>

<p>Visually inspect the mesh for the assignment of boundary zones such as top nodes.</p>

<!-- Lightbox -->
<div class="uk-child-width-1-2@m" uk-grid="" uk-lightbox="animation: slide">
    <div>
        <a class="uk-inline" href="/pages/tutorial/stratigraphy/images/21_tet_01_fehm_node_zone_top.png" data-caption="GMV visualization of mesh nodes, with top nodes colored red">
            <img src="/pages/tutorial/stratigraphy/images/21_tet_01_fehm_node_zone_top.png" alt="" />
        </a>
    </div>
</div>

<!-- Next / Prev -->
<ul class="uk-pagination">
    <li><a href="/pages/tutorial/stratigraphy/step_09.html"><span class="uk-margin-small-right" uk-pagination-previous=""></span> Previous</a></li>
    <li class="uk-margin-auto-left"><a href="/pages/tutorial/stratigraphy/step_10_exo.html">Next <span class="uk-margin-small-left" uk-pagination-next=""></span></a></li>
</ul>

<!-- Sidebar -->
<div class="tm-sidebar-right uk-visible@l">
    <div uk-sticky="offset: 160" class="uk-sticky uk-active uk-sticky-fixed" style="position: fixed; top: 160px; width: 200px;">
        <ul uk-scrollspy-nav="closest: li; scroll: true; offset: 100" class="uk-nav uk-nav-default tm-nav uk-nav-parent-icon">
            <li class=""><a href="/pages/tutorial/stratigraphy/index.html">Index</a></li>
            <li class=""><a href="/pages/tutorial/stratigraphy/step_01.html">1. Building a Hex Mesh</a></li>
            <li class=""><a href="/pages/tutorial/stratigraphy/step_02.html">2. Define Boundaries Using Point Sets</a></li>
            <li class=""><a href="/pages/tutorial/stratigraphy/step_03.html">3. Constructing Stratigraphy</a></li>
            <li class=""><a href="/pages/tutorial/stratigraphy/step_04.html">4. Map Surfaces to Mesh</a></li>
            <li class=""><a href="/pages/tutorial/stratigraphy/step_05.html">5. Constructing a Fault</a></li>
            <li class=""><a href="/pages/tutorial/stratigraphy/step_06.html">6. Truncate with Polyline</a></li>
            <li class=""><a href="/pages/tutorial/stratigraphy/step_07.html">7. Refine Fault</a></li>
            <li class=""><a href="/pages/tutorial/stratigraphy/step_08.html">8. Insert Wells</a></li>
            <li class=""><a href="/pages/tutorial/stratigraphy/step_09.html">9. Convert Hex Mesh to Tet</a></li>
            <li class="uk-active"><a href="#dump-fehm">10.1 Write FEHM Files</a></li>
            <li class=""><a href="/pages/tutorial/stratigraphy/step_10_exo.html">10.2 Write ExodusII Files</a></li>
            <li class="uk-nav-divider"></li>
            <!---->
            <li><a href="/pages/tutorial/stratigraphy/images/gallery.html" target="_blank"><span uk-icon="icon: image" class="uk-margin-small-right uk-icon"></span> <span class="uk-text-middle">Image Gallery</span></a></li>
            <li><a href="https://github.com/lanl/LaGriT/issues" target="_blank"><span uk-icon="icon: warning" class="uk-margin-small-right uk-icon"><svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="warning"><circle cx="10" cy="14" r="1"></circle><circle fill="none" stroke="#000" stroke-width="1.1" cx="10" cy="10" r="9"></circle><path d="M10.97,7.72 C10.85,9.54 10.56,11.29 10.56,11.29 C10.51,11.87 10.27,12 9.99,12 C9.69,12 9.49,11.87 9.43,11.29 C9.43,11.29 9.16,9.54 9.03,7.72 C8.96,6.54 9.03,6 9.03,6 C9.03,5.45 9.46,5.02 9.99,5 C10.53,5.01 10.97,5.44 10.97,6 C10.97,6 11.04,6.54 10.97,7.72 L10.97,7.72 Z"></path></svg></span> <span class="uk-text-middle">Report issue</span></a></li>
            <li><a href="mailto:lagrit-dev@lanl.gov" target="_blank"><span uk-icon="icon: commenting" class="uk-margin-small-right uk-icon"><svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg" data-svg="commenting"><polygon fill="none" stroke="#000" points="1.5,1.5 18.5,1.5 18.5,13.5 10.5,13.5 6.5,17.5 6.5,13.5 1.5,13.5"></polygon><circle cx="10" cy="8" r="1"></circle><circle cx="6" cy="8" r="1"></circle><circle cx="14" cy="8" r="1"></circle></svg></span> <span class="uk-text-middle">Get help</span></a></li>
        </ul>
    </div>
</div>


            </div>
        </div>

        <!-- Begin footer -->
        <footer class="footer-distributed">
            <div class="footer-right">
              <div><img src="/assets/img/lanl_logo_white.png" height="80"></div>
            </div>

            <div class="footer-left lg-background-color">
                <p class="footer-links" style="font-family: 'Fira Sans', sans-serif; color: white;">
                    <a href="/">Home</a>
                    ·
                    <a href="/pylagrit/original/index.html">PyLaGriT</a>
                    ·
                    <a href="https://int.lanl.gov/org/ddste/aldcels/ees/index.shtml">EES-16</a>
                    ·
                    <a href="/pages/licensing.html">License</a>
                    ·
                    <a href="https://lagrit.lanl.gov/">Contact</a>
                </p>

                <p>&copy; 2019 Los Alamos National Laboratory</p>
                <p>EES-16 | Computational Earth Science</p>
                <p>LA-CC-15-069</p>
            </div>
        </footer>

        <!-- Begin Navigation Bar -->
        <div id="offcanvas" uk-offcanvas="mode: push; overlay: true" class="uk-offcanvas">
            <div class="uk-offcanvas-bar">
                <div class="uk-panel">
                    <ul class="uk-nav uk-nav-default tm-nav">
                        <form class="uk-search uk-search-default" action="https://lanl.github.io/LaGriT/search/">
                            <a href="" uk-search-icon></a>
                            <input class="uk-search-input" type="search" placeholder="" name="q" id="tipue_search_input_mobile">
                        </form>
                        <li class="uk-nav-header">General</li>
                        <li><a href="/">Home</a></li>
                        <li><a href="/pages/commands">Commands</a></li>
                        <li><a href="/pages/release">Release Notes</a></li>
                        <li><a href="/pages/publications">Publications</a></li>
                        <li><a href="http://github.com/lanl/LaGriT">GitHub</a></li>
                    </ul>
                </div>
            </div>
        </div>
        <!-- End Navigation Bar -->

    </div>

</body>

</html>
